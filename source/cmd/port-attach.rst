
port attach: ポート生成機能
--------------------------------------------------------

* *CLI形式*

.. code-block:: none

    port attach DEVICE (|restore|default)

* *説明*

本機能は、DPDKのドライバにバインドされた物理デバイスを Kamuee のポート
として利用できるように、Kamuee内部のデータ構造などを初期化して準備しま
す。

* *処理*

  * 引数 DEVICE に指定されたデバイスをKamueeポートとして生成します。
  * 指定されたデバイスが以前にも使用されていたものであれば、前回の
    ポート設定をそのまま引き継ぐ(resore)か、新規ポートとしてデフォ
    ルト設定で再初期化する(default)かを選択可能とします。

* *引数*

  * 引数 DEVICE 部には 物理PCIデバイス識別子(BDF形式文字列)を指定します。
  * 引数 restore は、前回起動時のポート設定をそのまま引き継ぐことを指
    示します。
  * 引数 default は、前回起動時のポート設定は引き継がず、新規ポート
    として再初期化することを指示します。
  * 引数 restore, default のいずれも省略された場合の処理は、前回ポー
    ト起動時の設定の有無によって動的に判断します。

* *前提条件*

  * 物理PCIデバイスのドライバは事前に DPDK PMD に bind 済であると
    想定します (Kamuee の device bind コマンドや DPDKに付属の外部コ
    マンド dpdk-devbind.py の利用を想定します)。
  * 新規ポートID(ポート番号)は、DPDK により動的に配番された値を
    Kamueeでも採用するものとします。
  * すでにKamueeにアタッチ済のポートについては何も処理を行いません。
  * 引数 DEVICE に指定するデバイスアドレス文字列は DPDK API関数
    rte_pci_addr_parse() によって解釈可能な形式に限ります。
  * 実際のポート起動前にポートコンフィグレーション用コマンドを投入
    できるように、ポートの起動は port start コマンドによって別途行
    うものとします。

* *備考*

  * ポートを再初期化して生成した場合、port start 前に最低でも
    fowarder スレッドの設定だけは投入し直す必要があります。
  * DPDKが空いているポート番号から若番順に配番するため、同じ物理デバ
    イスであってもポート番号が変わる可能性があります。


